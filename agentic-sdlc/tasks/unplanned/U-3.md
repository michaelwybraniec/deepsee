# Task ID: U-3
# Title: Implement UI smoke tests (E2E tests)
# Status: [ ] Pending
# Priority: high
# Owner: Frontend Dev
# Estimated Effort: 4-6h

## Description
Implement end-to-end (E2E) tests for the React frontend to complete the required test categories from `docs/requirements.md` section "11. Tests". The directory structure exists (`frontend/tests/e2e/`), but no actual test implementations are present.

## Dependencies
- [x] Task ID: 10 (Frontend must be implemented)
- [x] Task ID: 11.2 (Test structure must be organized)

## Requirements
1. **Test Framework Setup**:
   - Choose E2E testing framework (Playwright recommended, Cypress as alternative)
   - Install and configure test framework
   - Set up test configuration (base URL, timeouts, browser options)
   - Configure test scripts in `package.json`

2. **Critical User Flows to Test**:
   - **Authentication**:
     - User registration
     - User login
     - User logout
     - Change password
   - **Task Management**:
     - Create new task
     - View task list
     - View task details
     - Edit existing task
     - Delete task
   - **Attachments**:
     - Upload attachment to task
     - View attachment list
     - Delete attachment
   - **Search & Filtering**:
     - Search tasks by title/description
     - Filter by status, priority, tags, due date
     - Sort tasks
     - Paginate results
     - "Show only my tasks" filter

3. **Test Data Management**:
   - Set up test user accounts (via API or fixtures)
   - Clean up test data after tests
   - Use isolated test data (don't interfere with development data)

4. **CI/CD Integration**:
   - Configure tests to run in CI/CD pipeline
   - Add test script to root `package.json` if needed
   - Document how to run tests locally

## Implementation Steps

### Step 1: Choose and Set Up Test Framework
1. **Decision**: Choose Playwright (recommended) or Cypress
   - **Playwright**: Modern, fast, supports multiple browsers, good TypeScript support
   - **Cypress**: Popular, good documentation, but slower and single-browser focused
   - **Recommendation**: Playwright for better performance and multi-browser support
2. Install test framework:
   ```bash
   cd frontend
   npm install --save-dev @playwright/test
   # OR
   npm install --save-dev cypress
   ```
3. Initialize test configuration:
   - Create `playwright.config.js` or `cypress.config.js`
   - Configure base URL (e.g., `http://localhost:5173`)
   - Set up browser options (headless for CI, headed for local)
   - Configure timeouts and retries

### Step 2: Set Up Test Utilities
1. Create test utilities (`frontend/tests/e2e/utils/`):
   - `auth-helpers.js`: Functions for login, logout, registration
   - `api-helpers.js`: Functions for API calls (create test users, tasks, cleanup)
   - `page-objects.js`: Page object model for reusable selectors and actions
2. Create test fixtures:
   - `test-user.json`: Test user credentials
   - `test-data.json`: Sample task data

### Step 3: Implement Authentication Tests
1. Create `frontend/tests/e2e/auth.spec.js` (or `.ts`):
   - Test: User can register new account
   - Test: User can login with valid credentials
   - Test: User cannot login with invalid credentials
   - Test: User can logout
   - Test: User can change password
   - Test: Protected routes redirect to login when not authenticated

### Step 4: Implement Task Management Tests
1. Create `frontend/tests/e2e/tasks.spec.js`:
   - Test: User can view task list
   - Test: User can create new task with all fields
   - Test: User can view task details
   - Test: User can edit existing task
   - Test: User can delete task
   - Test: User can only modify their own tasks (authorization)

### Step 5: Implement Attachment Tests
1. Create `frontend/tests/e2e/attachments.spec.js`:
   - Test: User can upload attachment to task
   - Test: User can view attachment list
   - Test: User can delete attachment
   - Test: File name and size are displayed correctly

### Step 6: Implement Search & Filter Tests
1. Create `frontend/tests/e2e/search-filter.spec.js`:
   - Test: User can search tasks by title
   - Test: User can search tasks by description
   - Test: User can filter by status
   - Test: User can filter by priority
   - Test: User can filter by tags
   - Test: User can filter by due date
   - Test: User can sort tasks
   - Test: User can paginate results
   - Test: "Show only my tasks" filter works correctly

### Step 7: Add Test Scripts and Documentation
1. Update `frontend/package.json`:
   ```json
   {
     "scripts": {
       "test:e2e": "playwright test",
       "test:e2e:ui": "playwright test --ui",
       "test:e2e:headed": "playwright test --headed"
     }
   }
   ```
2. Update `frontend/tests/e2e/README.md`:
   - Document how to run tests
   - Document test structure
   - Document test data setup
   - Document CI/CD integration

### Step 8: CI/CD Integration
1. Add E2E test step to CI/CD pipeline (if applicable):
   - Run tests in headless mode
   - Ensure backend and frontend are running
   - Clean up test data after tests
2. Document CI/CD requirements in README

## Acceptance Criteria
- [ ] Test framework installed and configured (Playwright or Cypress)
- [ ] Test configuration file exists (`playwright.config.js` or `cypress.config.js`)
- [ ] Authentication tests implemented (register, login, logout, change password)
- [ ] Task management tests implemented (CRUD operations)
- [ ] Attachment tests implemented (upload, list, delete)
- [ ] Search & filter tests implemented (search, filter, sort, paginate)
- [ ] Test utilities and helpers created (auth helpers, API helpers, page objects)
- [ ] Test scripts added to `package.json`
- [ ] Tests can be run locally with `npm run test:e2e`
- [ ] Tests run in headless mode for CI/CD
- [ ] Test data is properly isolated and cleaned up
- [ ] README updated with test documentation
- [ ] All critical user flows are covered by tests

## Test Examples

### Example: Login Test (Playwright)
```javascript
import { test, expect } from '@playwright/test';

test('user can login with valid credentials', async ({ page }) => {
  await page.goto('/login');
  await page.fill('input[name="username"]', 'testuser');
  await page.fill('input[name="password"]', 'testpass123');
  await page.click('button[type="submit"]');
  await expect(page).toHaveURL('/tasks');
  await expect(page.locator('text=Tasks')).toBeVisible();
});
```

### Example: Create Task Test (Playwright)
```javascript
test('user can create new task', async ({ page }) => {
  // Login first
  await loginAsTestUser(page);
  
  // Navigate to create task
  await page.goto('/tasks/new');
  await page.fill('input[name="title"]', 'Test Task');
  await page.fill('textarea[name="description"]', 'Test Description');
  await page.selectOption('select[name="status"]', 'todo');
  await page.selectOption('select[name="priority"]', 'high');
  await page.click('button[type="submit"]');
  
  // Verify task created
  await expect(page).toHaveURL(/\/tasks\/\d+/);
  await expect(page.locator('text=Test Task')).toBeVisible();
});
```

## Notes
- **Priority**: High - This is required by `docs/requirements.md` section "11. Tests"
- **Current Status**: Directory structure exists (`frontend/tests/e2e/`) but no tests implemented
- **Framework Choice**: Playwright recommended for better performance and multi-browser support
- **Test Data**: Use API helpers to create/cleanup test data to avoid database state issues
- **CI/CD**: Tests should run in headless mode and be fast enough for CI pipeline

## Related Tasks
- Task 10: React frontend (prerequisite - frontend must be implemented)
- Task 11.2: Implement required test categories (test structure organized)

## References
- `docs/requirements.md` section "11. Tests": "UI smoke tests"
- `frontend/tests/e2e/README.md`: Current test directory structure
- `docs/requirements-gap-analysis.md`: Gap analysis identifying this as missing
