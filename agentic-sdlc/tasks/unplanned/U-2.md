# Task ID: U-2
# Title: Implement partial/substring tag matching in search
# Status: [x] Completed
# Priority: medium
# Owner: Backend Dev
# Estimated Effort: 0.5-1h

## Description
Currently, tag filtering requires exact matches (e.g., "project" matches "project" but "projec" does not). This task implements partial/substring matching for tags to improve user experience and consistency with the existing search behavior (which uses partial matching for title/description).

## Dependencies
- [x] Task ID: 5.4 (Search, filtering, sorting, pagination must be implemented)

## Requirements
1. **Partial Tag Matching**:
   - Filter tags should match if they are substrings of any task tag
   - Matching should be case-insensitive (consistent with search behavior)
   - Example: Filter "projec" should match task tags ["project", "urgent"]
   - Example: Filter "urg" should match task tags ["urgent", "important"]

2. **Consistency**:
   - Match the existing search behavior pattern (uses `ilike` for partial matching)
   - Maintain backward compatibility (exact matches still work)

3. **Performance**:
   - Current implementation already filters in Python (SQLite JSON limitation)
   - Performance impact is minimal since filtering happens in-memory

## Recommended Approach

### Backend Implementation (Recommended)

**Why Backend:**
- ✅ Consistent with existing search behavior (title/description use partial matching)
- ✅ Single source of truth for filtering logic
- ✅ Works correctly with pagination (filters before pagination)
- ✅ Works for all clients (web, mobile, API consumers)
- ✅ Minimal performance impact (already filtering in Python)

**Implementation Location:**
- File: `backend/application/tasks/search_tasks.py`
- Line: ~124 (tag filtering logic)

**Current Code:**
```python
# Check if any task tag matches any filter tag (exact match)
if any(tag in task_tags for tag in tags):
    filtered_tasks.append(task)
```

**Recommended Change:**
```python
# Check if any filter tag is a substring of any task tag (case-insensitive partial match)
if any(any(filter_tag.lower() in task_tag.lower() for task_tag in task_tags) for filter_tag in tags):
    filtered_tasks.append(task)
```

**Alternative (More Readable):**
```python
# Check if any filter tag matches any task tag (case-insensitive partial match)
def tag_matches(filter_tag: str, task_tags: list) -> bool:
    """Check if filter_tag is a substring of any task tag (case-insensitive)."""
    filter_lower = filter_tag.lower()
    return any(filter_lower in task_tag.lower() for task_tag in task_tags)

if any(tag_matches(filter_tag, task_tags) for filter_tag in tags):
    filtered_tasks.append(task)
```

### Why Not Frontend?

Frontend-only filtering has significant limitations:
- ❌ Only filters already-loaded tasks (breaks with pagination)
- ❌ Inconsistent with backend search behavior
- ❌ Duplicates logic across client/server
- ❌ Doesn't work for API consumers

## Implementation Steps
1. Open `backend/application/tasks/search_tasks.py`
2. Locate the tag filtering logic (around line 124)
3. Replace exact matching with case-insensitive substring matching
4. Add helper function for readability (optional but recommended)
5. Update API documentation to reflect partial matching behavior
6. Test with various scenarios:
   - Exact matches still work ("project" matches "project")
   - Partial matches work ("projec" matches "project")
   - Case-insensitive ("PROJECT" matches "project")
   - Multiple tags in filter
   - Multiple tags in task

## Acceptance Criteria
- [ ] Filter "projec" matches tasks with tag "project"
- [ ] Filter "urg" matches tasks with tag "urgent"
- [ ] Exact matches still work ("project" matches "project")
- [ ] Matching is case-insensitive ("PROJECT" matches "project")
- [ ] Multiple filter tags work correctly
- [ ] Pagination still works correctly with partial matching
- [ ] API documentation updated to reflect partial matching behavior
- [ ] No performance regression (filtering still happens in Python)

## Testing Scenarios
1. **Exact Match**: Filter "project" → matches task with tag "project" ✅
2. **Partial Match**: Filter "projec" → matches task with tag "project" ✅
3. **Case Insensitive**: Filter "PROJECT" → matches task with tag "project" ✅
4. **Multiple Tags**: Filter "proj,urg" → matches tasks with either "project" or "urgent" ✅
5. **No Match**: Filter "xyz" → doesn't match task with tag "project" ✅
6. **Pagination**: Verify pagination works correctly with partial matching ✅

## Notes
- This change improves UX consistency with the existing search functionality
- The implementation is straightforward since tag filtering already happens in Python
- No database changes required
- Backward compatible (exact matches continue to work)

## Related Tasks
- Task 5.4: Implement filters, sorting, and pagination (prerequisite)
- Task 5.3: Implement search by title and description (reference for partial matching pattern)
